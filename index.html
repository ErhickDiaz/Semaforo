<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Monitor de Viajes</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    .filtro-container {
      text-align: center;
      margin-bottom: 20px;
    }
    .centrado {
      max-width: 800px;
      margin: 0 auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid #ccc;
    }
    th {
      background-color: #333;
      color: white;
    }
    .verde {
      background-color: #c8e6c9;
    }
    .amarillo {
      background-color: #fff9c4;
    }
    .rojo {
      background-color: #ffcdd2;
    }
    .sin-datos {
      background-color: #e0e0e0;
    }
    .fecha-actualizacion {
      font-size: 0.9em;
      color: #555;
    }
  </style>
</head>
<body>
  <div class="filtro-container">
    <label for="filtro">Filtrar por tipo: </label>
    <select id="filtro">
      <option value="Todos">Todos</option>
      <option value="Asignado">Asignado</option>
      <option value="Carga">Carga</option>
      <option value="Despacho">Despacho</option>
      <option value="Retorno">Retorno</option>
    </select>
  </div>

  <div id="contenedor-tabla" class="centrado">
    <table id="tabla">
      <thead>
        <tr id="encabezado"></tr>
      </thead>
      <tbody id="cuerpo"></tbody>
    </table>
  </div>

  <script>
    const encabezadosTodosAsignado = ["Patente", "Ruta", "Semáforo", "Última Actualización"];
    const encabezadosCompleto = ["Patente", "Ruta", "Semáforo", "Última Actualización", "Latitud", "Longitud"];
    const cuerpoTabla = document.getElementById("cuerpo");
    const encabezadoTabla = document.getElementById("encabezado");
    const contenedor = document.getElementById("contenedor-tabla");
    const filtro = document.getElementById("filtro");

    async function cargarDatos() {
      const response = await fetch("viajes.csv");
      const texto = await response.text();
      const lineas = texto.trim().split("\n").slice(1); // quitar encabezado CSV
      return lineas.map(linea => linea.split(","));
    }

    function obtenerColor(valor) {
      if (valor.toLowerCase().includes("verde")) return "verde";
      if (valor.toLowerCase().includes("amarillo")) return "amarillo";
      if (valor.toLowerCase().includes("rojo")) return "rojo";
      return "sin-datos";
    }

    function actualizarEncabezado(encabezados) {
      encabezadoTabla.innerHTML = "";
      encabezados.forEach(texto => {
        const th = document.createElement("th");
        th.textContent = texto;
        encabezadoTabla.appendChild(th);
      });
    }

    function mostrarDatos(data, tipo) {
      cuerpoTabla.innerHTML = "";
      const encabezados = (tipo === "Todos" || tipo === "Asignado") ? encabezadosTodosAsignado : encabezadosCompleto;
      actualizarEncabezado(encabezados);

      // Centrar tabla solo para "Todos" o "Asignado"
      if (tipo === "Todos" || tipo === "Asignado") {
        contenedor.classList.add("centrado");
      } else {
        contenedor.classList.remove("centrado");
      }

      data.forEach(cols => {
        if (cols.length < 4) return; // asegurarse de que hay suficientes columnas

        // Filtro por tipo
        if (tipo !== "Todos" && cols[1] !== tipo) return;

        const fila = document.createElement("tr");

        encabezados.forEach(col => {
          const td = document.createElement("td");
          let valor = "";

          switch(col) {
            case "Patente":
              valor = cols[0] || "-";
              break;
            case "Ruta":
              valor = cols[1] || "-";
              break;
            case "Semáforo":
              valor = cols[2] || "sin datos";
              td.className = obtenerColor(valor);
              break;
            case "Última Actualización":
              valor = cols[3] || "-";
              td.className = "fecha-actualizacion";
              break;
            case "Latitud":
              valor = cols[4] || "-";
              break;
            case "Longitud":
              valor = cols[5] || "-";
              break;
          }

          td.textContent = valor;
          fila.appendChild(td);
        });

        cuerpoTabla.appendChild(fila);
      });
    }

    async function init() {
      const datos = await cargarDatos();
      filtro.addEventListener("change", () => mostrarDatos(datos, filtro.value));
      mostrarDatos(datos, filtro.value);
    }

    init();
  </script>
</body>
</html>
